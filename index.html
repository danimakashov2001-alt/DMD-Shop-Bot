<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>–ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤</title>

<link rel="stylesheet" href="https://unpkg.com/photoswipe@5/dist/photoswipe.css">

<style>
  html, body {
    margin:0; padding:0; width:100%; height:100%;
    font-family:-apple-system,BlinkMacSystemFont,Arial;
    color:#fff;
    background: url("https://iili.io/fXfx3ep.jpg") center / cover no-repeat;
    background-color:#0b0b0b;
    overscroll-behavior: none;
  }
  body::before{
    content:"";
    position:fixed;
    inset:0;
    background:rgba(0,0,0,0.55);
    pointer-events:none;
    z-index:-1;
  }

  header{
    height:46px;
    display:flex;
    align-items:center;
    justify-content:space-between;
    padding:0 14px;
    background:rgba(17,17,17,0.9);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    font-weight:600;
    gap:12px;
  }
  .header-title{ white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }

  .btn{
    appearance:none;
    border:1px solid rgba(255,255,255,0.12);
    padding:8px 12px;
    border-radius:12px;
    background:rgba(31,31,31,0.75);
    color:#fff;
    font-weight:600;
    cursor:pointer;
  }
  .btn:active{ transform:scale(0.98); }

  .page{ height:calc(100vh - 46px); overflow-y:auto; }

  /* —Ç–æ–≤–∞—Ä—ã */
  .catalog{
    padding:14px;
    display:grid;
    grid-template-columns:repeat(auto-fill,minmax(160px,1fr));
    gap:14px;
  }
  .card{
    border-radius:16px;
    overflow:hidden;
    cursor:pointer;
    transition:transform .2s;
    position:relative;
    background:rgba(255,255,255,0.06);
    border:1px solid rgba(255,255,255,0.10);
    backdrop-filter: blur(6px);
    -webkit-backdrop-filter: blur(6px);
  }
  .card:hover{transform:scale(1.03);}
  .card img{ width:100%; height:210px; object-fit:cover; display:block; }

  /* –ë–ª–æ–∫ —Ç–µ–∫—Å—Ç–∞ —Ç–µ–º–Ω–µ–µ */
  .card-body{
    position:absolute;
    left:0; right:0; bottom:0;
    padding:10px 10px 11px;
    font-size:13px;
    line-height:1.25;
    background:linear-gradient(transparent, rgba(0,0,0,0.88));
  }
  .name{
    font-weight:800;
    display:-webkit-box;
    -webkit-line-clamp:2;
    -webkit-box-orient:vertical;
    overflow:hidden;
  }

  /* ‚úÖ description –≤ –ª–µ–Ω—Ç–µ */
  .short-desc{
    margin-top:6px;
    opacity:0.9;
    display:-webkit-box;
    -webkit-line-clamp:2;
    -webkit-box-orient:vertical;
    overflow:hidden;
    font-size:12px;
    line-height:1.25;
  }

  .status{ display:inline-block; margin-top:6px; font-weight:800; }
  .status.instock{ color:#38d66b; } /* –∑–µ–ª—ë–Ω—ã–π */
  .status.inway{ color:#ffd54a; }   /* –∂—ë–ª—Ç—ã–π */
  .price{ margin-top:6px; font-weight:800; opacity:0.95; }

  /* –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ */
  .categories{ padding:14px; display:flex; flex-direction:column; gap:12px; }
  .cat-card{
    background:rgba(17,17,17,0.85);
    border:1px solid rgba(255,255,255,0.10);
    border-radius:16px;
    padding:12px 12px 10px;
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
  }
  .cat-title{ font-weight:800; margin-bottom:10px; }
  .subcats{ display:flex; flex-wrap:wrap; gap:10px; }
  .chip{
    padding:8px 12px;
    border-radius:999px;
    background:rgba(31,31,31,0.75);
    border:1px solid rgba(255,255,255,0.10);
    cursor:pointer;
    user-select:none;
    font-size:13px;
  }
  .chip:active{ transform:scale(0.98); }
  .hint{ padding:0 14px 14px; color:rgba(255,255,255,0.78); font-size:12px; }

  /* –æ–±—â–∏–µ */
  .is-hidden{ display:none !important; }
  .empty{ padding:14px; color:rgba(255,255,255,0.85); font-size:13px; }

  /* ===== PhotoSwipe: caption —Å–Ω–∏–∑—É (–≤—Å—Ç–∞–≤–ª—è–µ–º –≤—Ä—É—á–Ω—É—é) ===== */
  .pswp__custom-caption{
    position:absolute;
    left:0; right:0; bottom:0;
    z-index: 99999;
    box-sizing:border-box;

    padding:14px 16px;
    padding-bottom: calc(14px + env(safe-area-inset-bottom));

    background:linear-gradient(transparent, rgba(0,0,0,0.92));
    color:#fff;
    font-size:13px;
    transition:opacity .18s ease;
    pointer-events:none;
    text-shadow: 0 1px 2px rgba(0,0,0,0.65);
  }
  .pswp__custom-caption.pswp-caption--hidden{ opacity:0; }

  .pswp__custom-caption .title{
    font-size:15px;
    font-weight:900;
    margin-bottom:6px;
  }
  .pswp__custom-caption .desc{
    white-space:pre-line;  /* ‚úÖ –ø–µ—Ä–µ–Ω–æ—Å—ã */
    line-height:1.35;
    opacity:0.95;
  }
  .pswp__custom-caption .meta{
    margin-top:8px;
    font-weight:900;
    display:flex;
    gap:10px;
    align-items:center;
    flex-wrap:wrap;
  }
  .pswp__custom-caption .instock{ color:#38d66b; }
  .pswp__custom-caption .inway{ color:#ffd54a; }
</style>
</head>

<body>
<header>
  <div class="header-title" id="headerTitle">üõç –ö–∞—Ç–∞–ª–æ–≥</div>
  <button class="btn" id="toggleBtn">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</button>
</header>

<div class="page" id="productsPage">
  <div class="catalog" id="catalog"></div>
  <div class="empty is-hidden" id="emptyState">–ü–æ–∫–∞ –Ω–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤ –≤ —ç—Ç–æ–π –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏.</div>
</div>

<div class="page is-hidden" id="categoriesPage">
  <div class="categories" id="categories"></div>
  <div class="hint">–ù–∞–∂–º–∏ –Ω–∞ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—é ‚Äî –ø–æ–∫–∞–∂—É —Ç–æ–≤–∞—Ä—ã.</div>
</div>

<script type="module">
import PhotoSwipeLightbox from 'https://unpkg.com/photoswipe@5/dist/photoswipe-lightbox.esm.min.js';

/* ====== –¢–æ–≤–∞—Ä—ã ====== */
const products = [
  {
    name:"–ó–∏–ø —Ö—É–¥–∏ Zara Type crop fit (—Å–µ—Ä—ã–π)",
    price:4300,
    status:"–í –Ω–∞–ª–∏—á–∏–∏",
    description:"–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –º–æ–¥–µ–ª–∏: 185/70, —Ä–∞–∑–º–µ—Ä L.",
    fullDescription:
`–ó–∏–ø —Ö—É–¥–∏ Zara Type crop fit (—Å–µ—Ä—ã–π)

‚Ä¢ –ü–æ—Å–∞–¥–∫–∞: crop fit
‚Ä¢ –ú–∞—Ç–µ—Ä–∏–∞–ª: –ø–ª–æ—Ç–Ω—ã–π —Ö–ª–æ–ø–æ–∫
‚Ä¢ –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –º–æ–¥–µ–ª–∏: 185/70, —Ä–∞–∑–º–µ—Ä L
‚Ä¢ –£—Ö–æ–¥: –¥–µ–ª–∏–∫–∞—Ç–Ω–∞—è —Å—Ç–∏—Ä–∫–∞ 30¬∞
‚Ä¢ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏: –º–æ–ª–Ω–∏—è –ø–æ –≤—Å–µ–π –¥–ª–∏–Ω–µ, –º—è–≥–∫–∞—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Å—Ç–æ—Ä–æ–Ω–∞`,
    subcategory:"zip_hoodies",
    photos:[
      "https://iili.io/fVQvE5F.jpg",
      "https://iili.io/fVQU5WG.jpg",
      "https://iili.io/fVQUMbe.webp",
      "https://iili.io/fVQUv5P.webp"
    ]
  },
  {
    name:"–ó–∏–ø —Ö—É–¥–∏ Zara Type crop fit (—á—ë—Ä–Ω—ã–π)",
    price:4300,
    status:"–í –Ω–∞–ª–∏—á–∏–∏",
    description:"–ú–∏–Ω–∏–º–∞–ª–∏–∑–º. –ü–ª–æ—Ç–Ω—ã–π —Ö–ª–æ–ø–æ–∫.",
    fullDescription:
`–ó–∏–ø —Ö—É–¥–∏ Zara Type crop fit (—á—ë—Ä–Ω—ã–π)

‚Ä¢ –°—Ç–∏–ª—å: –º–∏–Ω–∏–º–∞–ª–∏–∑–º
‚Ä¢ –ú–∞—Ç–µ—Ä–∏–∞–ª: –ø–ª–æ—Ç–Ω—ã–π —Ö–ª–æ–ø–æ–∫
‚Ä¢ –ü–æ—Å–∞–¥–∫–∞: crop fit
‚Ä¢ –£—Ö–æ–¥: –¥–µ–ª–∏–∫–∞—Ç–Ω–∞—è —Å—Ç–∏—Ä–∫–∞ 30¬∞
‚Ä¢ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏: –¥–µ—Ä–∂–∏—Ç —Ñ–æ—Ä–º—É, —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —Ü–≤–µ—Ç`,
    subcategory:"zip_hoodies",
    photos:[
      "https://iili.io/fVQ6E4j.webp",
      "https://iili.io/fVQ6ba4.webp",
      "https://iili.io/fVQPF6b.webp",
      "https://iili.io/fVQPuMg.webp",
      "https://iili.io/fVQP0NI.webp"
    ]
  },
  {
    name:"–ó–∏–ø —Ö—É–¥–∏ No Faith Studio boxy crop fit",
    price:4100,
    status:"–í –Ω–∞–ª–∏—á–∏–∏",
    description:"Y2K / Opium —Å—Ç–∏–ª—å.",
    fullDescription:
`–ó–∏–ø —Ö—É–¥–∏ No Faith Studio boxy crop fit

‚Ä¢ –°—Ç–∏–ª—å: Y2K / Opium
‚Ä¢ –ü–æ—Å–∞–¥–∫–∞: boxy + crop
‚Ä¢ –ú–∞—Ç–µ—Ä–∏–∞–ª: –ø–ª–æ—Ç–Ω–∞—è —Ç–∫–∞–Ω—å
‚Ä¢ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏: —à–∏—Ä–æ–∫–∏–π —Å–∏–ª—É—ç—Ç, –∞–∫—Ü–µ–Ω—Ç–Ω—ã–π –∫—Ä–æ–π`,
    subcategory:"zip_hoodies",
    photos:[
      "https://iili.io/fXB5Ctj.jpg",
      "https://iili.io/fXqKi8B.webp",
      "https://iili.io/fXqfRte.webp"
    ]
  },
  {
    name:"–õ–æ–Ω–≥—Å–ª–∏–≤ Derschutze crop fit",
    price:3890,
    status:"–í –Ω–∞–ª–∏—á–∏–∏",
    description:"–≠–∫—Å–∫–ª—é–∑–∏–≤–Ω–∞—è –≤—ã—à–∏–≤–∫–∞.",
    fullDescription:
`–õ–æ–Ω–≥—Å–ª–∏–≤ Derschutze crop fit

‚Ä¢ –î–µ—Ç–∞–ª–∏: —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω–∞—è –≤—ã—à–∏–≤–∫–∞
‚Ä¢ –ú–∞—Ç–µ—Ä–∏–∞–ª: –º—è–≥–∫–∏–π —Ö–ª–æ–ø–æ–∫
‚Ä¢ –ü–æ—Å–∞–¥–∫–∞: crop fit
‚Ä¢ –£—Ö–æ–¥: –¥–µ–ª–∏–∫–∞—Ç–Ω–∞—è —Å—Ç–∏—Ä–∫–∞ 30¬∞
‚Ä¢ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏: –∏–¥–µ–∞–ª–µ–Ω –ø–æ–¥ —Å–ª–æ–π, –∫–æ–º—Ñ–æ—Ä—Ç–Ω–∞—è –ø–æ—Å–∞–¥–∫–∞`,
    subcategory:"longsleeves",
    photos:[
      "https://iili.io/fVQgdrl.webp",
      "https://iili.io/fVQgbaV.webp",
      "https://iili.io/fVQrMMb.webp",
      "https://iili.io/fVQrkDF.webp",
      "https://iili.io/fVQ4JJ2.webp",
      "https://iili.io/fVQ4I5B.webp"
    ]
  }
];

/* ====== –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ ====== */
const categoryTree = [
  { title: "–ì–æ–ª–æ–≤–Ω—ã–µ —É–±–æ—Ä—ã", subs: ["–®–∞–ø–∫–∏", "–ö–µ–ø–∫–∏"] },
  { title: "–í–µ—Ä—Ö", subs: ["–ó–∏–ø –•—É–¥–∏", "–õ–æ–Ω–≥—Å–ª–∏–≤—ã", "–§—É—Ç–±–æ–ª–∫–∏"] },
  { title: "–ù–∏–∑", subs: ["–î–∂–∏–Ω—Å—ã", "–ë—Ä—é–∫–∏", "–®–æ—Ä—Ç—ã"] },
  { title: "–û–±—É–≤—å", subs: ["–ö—Ä–æ—Å—Å–æ–≤–∫–∏", "–¢—É—Ñ–ª–∏"] }
];

const subcategoryMap = {
  "–ó–∏–ø –•—É–¥–∏": "zip_hoodies",
  "–õ–æ–Ω–≥—Å–ª–∏–≤—ã": "longsleeves",
};

function statusClass(status){
  const s = (status || "").toLowerCase();
  if (s.includes("–≤ –Ω–∞–ª–∏—á–∏–∏")) return "instock";
  if (s.includes("–≤ –ø—É—Ç–∏")) return "inway";
  return "";
}

/* ====== DOM ====== */
const headerTitle = document.getElementById("headerTitle");
const toggleBtn = document.getElementById("toggleBtn");
const productsPage = document.getElementById("productsPage");
const categoriesPage = document.getElementById("categoriesPage");
const catalog = document.getElementById("catalog");
const categoriesEl = document.getElementById("categories");
const emptyState = document.getElementById("emptyState");

let currentFilter = null;
let currentProduct = null;

/* ====== –†–µ–Ω–¥–µ—Ä —Ç–æ–≤–∞—Ä–æ–≤ (description –≤ –ª–µ–Ω—Ç–µ) ====== */
function renderProducts() {
  catalog.innerHTML = "";
  emptyState.classList.add("is-hidden");

  const list = currentFilter
    ? products.filter(p => p.subcategory === currentFilter)
    : products;

  if (list.length === 0) {
    emptyState.classList.remove("is-hidden");
    return;
  }

  list.forEach((product) => {
    const stCls = statusClass(product.status);

    const card = document.createElement("div");
    card.className = "card";
    card.__product = product;

    card.innerHTML = `
      <img src="${product.photos[0]}" alt="">
      <div class="card-body">
        <div class="name">${product.name}</div>
        <div class="short-desc">${product.description ?? ""}</div>
        <div class="status ${stCls}">${product.status}</div>
        <div class="price">${product.price}</div>
      </div>
    `;
    catalog.appendChild(card);
  });
}

/* ====== –†–µ–Ω–¥–µ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–π ====== */
function renderCategories() {
  categoriesEl.innerHTML = "";
  categoryTree.forEach(cat => {
    const wrap = document.createElement("div");
    wrap.className = "cat-card";
    wrap.innerHTML = `<div class="cat-title">${cat.title}</div>`;

    const subs = document.createElement("div");
    subs.className = "subcats";

    cat.subs.forEach(subName => {
      const chip = document.createElement("div");
      chip.className = "chip";
      chip.textContent = subName;
      chip.dataset.subname = subName;
      subs.appendChild(chip);
    });

    wrap.appendChild(subs);
    categoriesEl.appendChild(wrap);
  });
}

/* ====== –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —ç–∫—Ä–∞–Ω–æ–≤ ====== */
function openCategories() {
  productsPage.classList.add("is-hidden");
  categoriesPage.classList.remove("is-hidden");
  toggleBtn.textContent = "–ù–∞–∑–∞–¥";
  headerTitle.textContent = "üìö –ö–∞—Ç–µ–≥–æ—Ä–∏–∏";
}
function closeCategories() {
  categoriesPage.classList.add("is-hidden");
  productsPage.classList.remove("is-hidden");
  toggleBtn.textContent = "–ö–∞—Ç–µ–≥–æ—Ä–∏–∏";
  headerTitle.textContent = currentFilter ? "üõç –ö–∞—Ç–∞–ª–æ–≥ ‚Ä¢ —Ñ–∏–ª—å—Ç—Ä" : "üõç –ö–∞—Ç–∞–ª–æ–≥";
}
toggleBtn.addEventListener("click", () => {
  const isOpen = !categoriesPage.classList.contains("is-hidden");
  isOpen ? closeCategories() : openCategories();
});

categoriesEl.addEventListener("click", (e) => {
  const chip = e.target.closest(".chip");
  if (!chip) return;

  const mapped = subcategoryMap[chip.dataset.subname];
  currentFilter = mapped || "__none__";
  renderProducts();
  closeCategories();
});

/* ====== PhotoSwipe (caption –≤—Å—Ç–∞–≤–ª—è–µ–º –≤—Ä—É—á–Ω—É—é) ====== */
const lightbox = new PhotoSwipeLightbox({
  pswpModule: () => import('https://unpkg.com/photoswipe@5/dist/photoswipe.esm.min.js'),
  wheelToZoom: true,
  arrowKeys: true,
  pswpOptions: { closeOnScroll: false }
});

function ensureCaption(pswp) {
  // pswp.element ‚Äî –∫–æ—Ä–Ω–µ–≤–æ–π —ç–ª–µ–º–µ–Ω—Ç PhotoSwipe (—Å–∞–º—ã–π –Ω–∞–¥—ë–∂–Ω—ã–π –¥–ª—è append)
  const root = pswp.element || pswp.template || pswp.container;
  if (!root) return null;

  let cap = root.querySelector('#pswpCaption');
  if (!cap) {
    cap = document.createElement('div');
    cap.className = 'pswp__custom-caption';
    cap.id = 'pswpCaption';
    cap.innerHTML = `
      <div class="title" id="pswpTitle"></div>
      <div class="desc" id="pswpDesc"></div>
      <div class="meta" id="pswpMeta"></div>
    `;
    root.appendChild(cap);
  }
  return cap;
}

function fillCaption(product) {
  const t = document.getElementById('pswpTitle');
  const d = document.getElementById('pswpDesc');
  const m = document.getElementById('pswpMeta');
  if (!t || !d || !m) return;

  t.textContent = product?.name ?? '';

  // ‚úÖ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º fullDescription, fallback –Ω–∞ description
  const fullText = (product?.fullDescription && String(product.fullDescription).trim())
    ? product.fullDescription
    : (product?.description ?? "");
  d.textContent = fullText;

  const stCls = statusClass(product?.status);
  const statusHtml = product?.status ? `<span class="${stCls}">${product.status}</span>` : '';
  const priceHtml = product?.price != null ? `<span>${product.price}</span>` : '';
  m.innerHTML = `${statusHtml}${priceHtml ? " ‚Ä¢ " + priceHtml : ""}`;
}

function syncCaptionVisibility(pswp) {
  const cap = document.getElementById('pswpCaption');
  if (!cap) return;
  const z = pswp.currZoomLevel || 1;
  cap.classList.toggle('pswp-caption--hidden', z > 1.02);
}

lightbox.on('open', () => {
  const pswp = lightbox.pswp;

  // ‚úÖ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ —Å–æ–∑–¥–∞—ë–º caption –≤ DOM
  requestAnimationFrame(() => {
    ensureCaption(pswp);
    fillCaption(currentProduct);
    syncCaptionVisibility(pswp);
  });

  pswp.on('zoomPanUpdate', () => syncCaptionVisibility(pswp));

  pswp.on('doubleTap', () => {
    const scale = pswp.currZoomLevel > 1 ? 1 : 2;
    pswp.zoomTo(scale, { x: pswp.viewportSize.x/2, y: pswp.viewportSize.y/2 });
  });

  // –Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π: –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ —É–±–∏—Ä–∞–µ–º caption, —á—Ç–æ–±—ã –Ω–µ –Ω–∞–∫–∞–ø–ª–∏–≤–∞–ª—Å—è
  pswp.on('destroy', () => {
    const cap = document.getElementById('pswpCaption');
    if (cap) cap.remove();
  });
});

lightbox.init();

/* ====== –û—Ç–∫—Ä—ã—Ç–∏–µ –∫–∞—Ä—Ç–æ—á–µ–∫ ====== */
catalog.addEventListener("click", (e) => {
  const card = e.target.closest(".card");
  if (!card) return;

  const product = card.__product;
  if (!product) return;

  currentProduct = product;

  const items = product.photos.map((src) => ({
    src,
    width: 1600,
    height: 2000
  }));

  lightbox.loadAndOpen(0, items);
});

/* init */
renderProducts();
renderCategories();
</script>

</body>
</html>
