<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>–ö–∞—Ç–∞–ª–æ–≥</title>

<style>
:root { --accent:#c49a6c }
*{margin:0;padding:0;box-sizing:border-box}

html, body {
  width: 100%;
  height: 100%;
  overflow: hidden;
  touch-action: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
  user-select: none;
}

body{
  font-family:-apple-system,BlinkMacSystemFont,Arial;
  background:#0b0b0b;
  color:#fff;
}

/* HEADER */
header{
  height:46px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:0 14px;
  background:rgba(15,15,15,.95);
}
button{
  background:var(--accent);
  border:none;
  padding:7px 16px;
  border-radius:18px;
  color:#fff;
}

/* CATALOG */
.catalog{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(160px,1fr));
  gap:14px;
  padding:14px;
  overflow-y:auto;
  height:calc(100vh - 46px);
}
.card{
  background:#fff;
  color:#000;
  border-radius:16px;
  overflow:hidden;
  cursor:pointer;
}
.card img{
  width:100%;
  height:210px;
  object-fit:cover;
}
.card-body{padding:10px;font-size:13px}

/* GALLERY */
#gallery{
  position:fixed;
  inset:0;
  background:#000;
  display:none;
  z-index:100;
  width:100%;
  height:100%;
  overflow:hidden;
}

.gallery-container{
  position:relative;
  width:100%;
  height:100%;
  display:flex;
  flex-direction:column;
}

.viewer-wrapper{
  flex:1;
  position:relative;
  overflow:hidden;
  width:100%;
  height:100%;
}

.viewer{
  position:absolute;
  inset:0;
  overflow:hidden;
  width:100%;
  height:100%;
  cursor:grab;
}

.viewer.grabbing{
  cursor:grabbing;
}

.viewer img{
  position:absolute;
  left:50%;
  top:50%;
  width:100%;
  height:100%;
  object-fit:contain;
  transform-origin:center center;
  user-select:none;
  -webkit-user-select:none;
  -webkit-touch-callout:none;
  pointer-events:none;
}

/* UI */
.gallery-header{
  position:absolute;
  top:0;
  left:0;
  right:0;
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:14px;
  background:linear-gradient(180deg,rgba(0,0,0,.7) 0%,transparent 100%);
  z-index:20;
  height:60px;
}

.close{
  font-size:26px;
  cursor:pointer;
  width:40px;
  height:40px;
  display:flex;
  align-items:center;
  justify-content:center;
  -webkit-user-select:none;
  user-select:none;
  -webkit-tap-highlight-color:transparent;
}

.counter{
  font-size:14px;
  background:rgba(0,0,0,.5);
  padding:6px 12px;
  border-radius:20px;
}

.arrow{
  position:absolute;
  top:50%;
  transform:translateY(-50%);
  font-size:40px;
  padding:12px;
  z-index:15;
  user-select:none;
  -webkit-user-select:none;
  cursor:pointer;
  width:50px;
  height:50px;
  display:flex;
  align-items:center;
  justify-content:center;
  -webkit-tap-highlight-color:transparent;
}
.arrow.left{left:10px}
.arrow.right{right:10px}

.dots{
  position:absolute;
  bottom:100px;
  left:50%;
  transform:translateX(-50%);
  display:flex;
  gap:8px;
  z-index:15;
}
.dot{
  width:8px;height:8px;border-radius:50%;
  background:rgba(255,255,255,.4);
  cursor:pointer;
  transition:background 0.2s;
  -webkit-tap-highlight-color:transparent;
}
.dot.active{background:#fff}

.info{
  position:absolute;
  bottom:0;
  left:0;right:0;
  background:linear-gradient(180deg,transparent 0%,rgba(0,0,0,.8) 100%);
  padding:12px 14px;
  font-size:12px;
  z-index:15;
  max-height:22%;
  overflow-y:auto;
}

.info-line{
  margin-bottom:4px;
  line-height:1.3;
}

.info-name{
  font-weight:600;
  font-size:13px;
  color:#fff;
}

.info-desc{
  font-size:11px;
  color:#aaa;
}

.info-status{
  font-size:11px;
  color:#7cb342;
}

.info-price{
  color:var(--accent);
  font-weight:600;
  font-size:12px;
}
</style>
</head>

<body>

<header>
  <h3>üõç –ö–∞—Ç–∞–ª–æ–≥</h3>
</header>

<div class="catalog" id="catalog"></div>

<div id="gallery">
  <div class="gallery-container">
    <div class="gallery-header">
      <div class="close" onclick="closeGallery()">‚úï</div>
      <div class="counter"><span id="current">1</span>/<span id="total">1</span></div>
    </div>
    <div class="viewer-wrapper">
      <div class="arrow left" onclick="prev()">‚Äπ</div>
      <div class="arrow right" onclick="next()">‚Ä∫</div>
      <div class="viewer" id="viewer"></div>
      <div class="dots" id="dots"></div>
    </div>
    <div class="info" id="info"></div>
  </div>
</div>

<script>
/* DATA */
const products=[
{
name:"–ó–∏–ø —Ö—É–¥–∏ Zara Type crop fit (—Å–µ—Ä—ã–π)",
price:4300,
status:"–í –Ω–∞–ª–∏—á–∏–∏",
description:"–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –º–æ–¥–µ–ª–∏: 185/70, —Ä–∞–∑–º–µ—Ä L.",
subcategory:"zip_hoodies",
photos:[
"https://iili.io/fVQvE5F.jpg",
"https://iili.io/fVQU5WG.jpg",
"https://iili.io/fVQUMbe.webp",
"https://iili.io/fVQUv5P.webp"
]
},
{
name:"–ó–∏–ø —Ö—É–¥–∏ Zara Type crop fit (—á—ë—Ä–Ω—ã–π)",
price:4300,
status:"–í –Ω–∞–ª–∏—á–∏–∏",
description:"–ú–∏–Ω–∏–º–∞–ª–∏–∑–º. –ü–ª–æ—Ç–Ω—ã–π —Ö–ª–æ–ø–æ–∫.",
subcategory:"zip_hoodies",
photos:[
"https://iili.io/fVQ6E4j.webp",
"https://iili.io/fVQ6ba4.webp",
"https://iili.io/fVQPF6b.webp",
"https://iili.io/fVQPuMg.webp",
"https://iili.io/fVQP0NI.webp"
]
},
{
name:"–ó–∏–ø —Ö—É–¥–∏ No Faith Studio boxy crop fit",
price:4100,
status:"–í –Ω–∞–ª–∏—á–∏–∏",
description:"Y2K / Opium —Å—Ç–∏–ª—å.",
subcategory:"zip_hoodies",
photos:[
"https://iili.io/fXB5Ctj.jpg",
"https://iili.io/fXqKi8B.webp",
"https://iili.io/fXqfRte.webp"
]
},
{
name:"–õ–æ–Ω–≥—Å–ª–∏–≤ Derschutze crop fit",
price:3890,
status:"–í –Ω–∞–ª–∏—á–∏–∏",
description:"–≠–∫—Å–∫–ª—é–∑–∏–≤–Ω–∞—è –≤—ã—à–∏–≤–∫–∞.",
subcategory:"longsleeves",
photos:[
"https://iili.io/fVQgdrl.webp",
"https://iili.io/fVQgbaV.webp",
"https://iili.io/fVQrMMb.webp",
"https://iili.io/fVQrkDF.webp",
"https://iili.io/fVQ4JJ2.webp",
"https://iili.io/fVQ4I5B.webp"
]
}
];

/* CATALOG */
const catalog=document.getElementById("catalog");
products.forEach(p=>{
  const c=document.createElement("div");
  c.className="card";
  c.innerHTML=`
    <img src="${p.photos[0]}" alt="${p.name}">
    <div class="card-body">${p.name}<br>${p.price} ‚ÇΩ</div>`;
  c.onclick=()=>openGallery(p);
  catalog.appendChild(c);
});

/* GALLERY CORE */
const gallery=document.getElementById("gallery");
const viewer=document.getElementById("viewer");
const dots=document.getElementById("dots");
const info=document.getElementById("info");
const current=document.getElementById("current");
const total=document.getElementById("total");

let currentProduct=null;
let photos=[],index=0,img;
let scale=1,tx=0,ty=0;
let zoomOffsetX=0,zoomOffsetY=0; // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–º–µ—â–µ–Ω–∏–µ —Ü–µ–Ω—Ç—Ä–∞ –∑—É–º–∞

// Touch variables
let touchStartX=0,touchStartY=0;
let touchLastX=0,touchLastY=0;
let startDist=0,startScale=1;
let startTx=0,startTy=0;
let lastTapTime=0;
let isDragging=false;
let isMultiTouch=false;

// Swipe variables
let swipeStartX=0;
let swipeStartTime=0;

function openGallery(p){
  currentProduct=p;
  photos=p.photos;
  index=0;
  gallery.style.display="block";
  document.body.style.overflow="hidden";
  load();
  updateInfo();
}

function closeGallery(){
  gallery.style.display="none";
  document.body.style.overflow="auto";
  currentProduct=null;
}

function load(){
  viewer.innerHTML="";
  img=document.createElement("img");
  img.src=photos[index];
  img.draggable=false;
  viewer.appendChild(img);
  reset();
  renderDots();
  updateCounter();
}

function reset(){
  scale=1;
  tx=0;
  ty=0;
  zoomOffsetX=0;
  zoomOffsetY=0;
  apply();
}

function apply(){
  if(img){
    img.style.transform=`translate(calc(-50% + ${tx}px), calc(-50% + ${ty}px)) scale(${scale})`;
  }
}

function updateCounter(){
  current.textContent=index+1;
  total.textContent=photos.length;
}

function updateInfo(){
  if(!currentProduct) return;
  info.innerHTML=`
    <div class="info-line info-name">${currentProduct.name}</div>
    <div class="info-line info-desc">${currentProduct.description}</div>
    <div class="info-line info-status">${currentProduct.status}</div>
    <div class="info-line info-price">${currentProduct.price} ‚ÇΩ</div>
  `;
}

/* NAV */
function prev(){ 
  if(index>0){
    index--;
    load();
  } 
}

function next(){ 
  if(index<photos.length-1){
    index++;
    load();
  } 
}

function goToPhoto(i){
  index=i;
  load();
}

function renderDots(){
  dots.innerHTML="";
  photos.forEach((_,i)=>{
    const d=document.createElement("div");
    d.className="dot"+(i===index?" active":"");
    d.onclick=()=>goToPhoto(i);
    dots.appendChild(d);
  });
}

/* DESKTOP: WHEEL ZOOM */
gallery.addEventListener("wheel",e=>{
  if(!img) return;
  e.preventDefault();
  
  const viewerRect=viewer.getBoundingClientRect();
  
  const cursorX=e.clientX-viewerRect.left;
  const cursorY=e.clientY-viewerRect.top;
  
  const prevScale=scale;
  const delta=e.deltaY<0?0.25:-0.25;
  scale=Math.min(4,Math.max(1,scale+delta));
  
  if(scale>1){
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ —Å–º–µ—â–µ–Ω–∏—è –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å, –∏–Ω–∞—á–µ —Å—á–∏—Ç–∞–µ–º –æ—Ç –∫—É—Ä—Å–æ—Ä–∞
    const centerOffsetX=zoomOffsetX!==0?zoomOffsetX:(cursorX-viewerRect.width/2);
    const centerOffsetY=zoomOffsetY!==0?zoomOffsetY:(cursorY-viewerRect.height/2);
    
    tx=-centerOffsetX*(scale/prevScale);
    ty=-centerOffsetY*(scale/prevScale);
  }else{
    tx=0;
    ty=0;
    zoomOffsetX=0;
    zoomOffsetY=0;
  }
  
  apply();
},{passive:false});

/* DESKTOP: DOUBLE CLICK & DRAG */
let isMouseDown=false;
let mouseDownX=0,mouseDownY=0;

viewer.addEventListener("mousedown",e=>{
  isMouseDown=true;
  mouseDownX=e.clientX;
  mouseDownY=e.clientY;
  startTx=tx;
  startTy=ty;
  
  if(scale>1){
    viewer.style.cursor="grabbing";
  }
});

document.addEventListener("mousemove",e=>{
  if(!isMouseDown||scale===1) return;
  
  const deltaX=e.clientX-mouseDownX;
  const deltaY=e.clientY-mouseDownY;
  
  tx=startTx+deltaX;
  ty=startTy+deltaY;
  apply();
});

document.addEventListener("mouseup",()=>{
  isMouseDown=false;
  if(scale>1){
    viewer.style.cursor="grab";
  }
});

viewer.addEventListener("dblclick",e=>{
  if(!img) return;
  
  const viewerRect=viewer.getBoundingClientRect();
  
  const cursorX=e.clientX-viewerRect.left;
  const cursorY=e.clientY-viewerRect.top;
  
  const prevScale=scale;
  
  // Toggle –∑—É–º
  if(scale===1){
    scale=2;
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–º–µ—â–µ–Ω–∏–µ –æ—Ç —Ü–µ–Ω—Ç—Ä–∞
    zoomOffsetX=cursorX-viewerRect.width/2;
    zoomOffsetY=cursorY-viewerRect.height/2;
    
    tx=-zoomOffsetX;
    ty=-zoomOffsetY;
  }else{
    scale=1;
    tx=0;
    ty=0;
    zoomOffsetX=0;
    zoomOffsetY=0;
  }
  
  apply();
});

/* TOUCH GESTURES */
viewer.addEventListener("touchstart",e=>{
  if(!img) return;
  
  if(e.touches.length===2){
    // Pinch zoom
    startDist=Math.hypot(
      e.touches[0].clientX-e.touches[1].clientX,
      e.touches[0].clientY-e.touches[1].clientY
    );
    startScale=scale;
    startTx=tx;
    startTy=ty;
    isMultiTouch=true;
    isDragging=false;
  }else if(e.touches.length===1){
    const now=Date.now();
    const touch=e.touches[0];
    
    touchStartX=touch.clientX;
    touchStartY=touch.clientY;
    touchLastX=touch.clientX;
    touchLastY=touch.clientY;
    startTx=tx;
    startTy=ty;
    
    swipeStartX=touch.clientX;
    swipeStartTime=now;
    
    isMultiTouch=false;
    isDragging=false;
    
    // Double tap detection
    if(now-lastTapTime<300){
      handleDoubleTap(touch.clientX,touch.clientY);
      lastTapTime=0;
    }else{
      lastTapTime=now;
    }
  }
},{passive:true});

viewer.addEventListener("touchmove",e=>{
  if(!img) return;
  
  if(e.touches.length===2 && isMultiTouch){
    // Pinch zoom
    e.preventDefault();
    
    const newDist=Math.hypot(
      e.touches[0].clientX-e.touches[1].clientX,
      e.touches[0].clientY-e.touches[1].clientY
    );
    
    const ratio=newDist/startDist;
    const newScale=Math.min(4,Math.max(1,startScale*ratio));
    
    // Center point between two fingers
    const centerX=(e.touches[0].clientX+e.touches[1].clientX)/2;
    const centerY=(e.touches[0].clientY+e.touches[1].clientY)/2;
    
    const viewerRect=viewer.getBoundingClientRect();
    const offsetX=centerX-viewerRect.left-viewerRect.width/2;
    const offsetY=centerY-viewerRect.top-viewerRect.height/2;
    
    scale=newScale;
    
    if(scale>1){
      tx=-offsetX*(scale/startScale);
      ty=-offsetY*(scale/startScale);
    }else{
      tx=0;
      ty=0;
    }
    
    apply();
  }else if(e.touches.length===1 && !isMultiTouch){
    const touch=e.touches[0];
    const deltaX=touch.clientX-touchStartX;
    const deltaY=touch.clientY-touchStartY;
    
    if(scale>1){
      // Dragging when zoomed
      e.preventDefault();
      isDragging=true;
      tx=startTx+deltaX;
      ty=startTy+deltaY;
      apply();
    }else if(Math.abs(deltaX)>5){
      // Swipe when not zoomed
      isDragging=true;
    }
  }
},{passive:false});

viewer.addEventListener("touchend",e=>{
  if(!img) return;
  
  if(e.touches.length===0){
    const touch=e.changedTouches[0];
    
    // Handle swipe if not zoomed and not dragging zoomed image
    if(scale===1 && isDragging){
      const deltaX=touch.clientX-swipeStartX;
      
      if(Math.abs(deltaX)>30){
        if(deltaX>0 && index>0){
          prev();
        }else if(deltaX<0 && index<photos.length-1){
          next();
        }
      }
    }
  }
  
  if(e.touches.length===1){
    touchStartX=e.touches[0].clientX;
    touchStartY=e.touches[0].clientY;
    startTx=tx;
    startTy=ty;
    isDragging=false;
    isMultiTouch=false;
  }else if(e.touches.length===0){
    isDragging=false;
    isMultiTouch=false;
  }
},{passive:false});

function handleDoubleTap(x,y){
  const viewerRect=viewer.getBoundingClientRect();
  
  const offsetX=x-viewerRect.left-viewerRect.width/2;
  const offsetY=y-viewerRect.top-viewerRect.height/2;
  
  if(scale===1){
    // –ü–µ—Ä–≤—ã–π —Ç–∞–ø - —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º
    scale=2;
    zoomOffsetX=offsetX;
    zoomOffsetY=offsetY;
    tx=-offsetX;
    ty=-offsetY;
  }else{
    // –ü–æ–≤—Ç–æ—Ä–Ω—ã–π —Ç–∞–ø - –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –≤ –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    scale=1;
    tx=0;
    ty=0;
    zoomOffsetX=0;
    zoomOffsetY=0;
  }
  
  apply();
}

// Prevent default iOS behavior
document.addEventListener('gesturestart',e=>e.preventDefault(),{passive:false});
</script>

</body>
</html>
